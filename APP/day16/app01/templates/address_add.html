{% extends "layout.html" %}

{% block content %}
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Add New Address</h3>
            </div>
            <div class="panel-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="form-group">
                            <label>{{ field.label }}</label>
                            {{ field }}
                            <span style="color:red;">{{ field.errors.0 }}</span>

                            {#                        <input type="text" class="form-control" placeholder="Name" name="user">#}
                        </div>
                    {% endfor %}

                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>

{% endblock %}
{% block js %}
    <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDW2OlR6mwJKIHg4xcvkV4eVFexO6UL4KM&callback=initAutocomplete&libraries=places&v=weekly"
            defer
    ></script>

    <script>
        /**
         * @license
         * Copyright 2019 Google LLC. All Rights Reserved.
         * SPDX-License-Identifier: Apache-2.0
         */
// This sample uses the Places Autocomplete widget to:
// 1. Help the user select a place
// 2. Retrieve the address components associated with that place
// 3. Populate the form fields with those address components.
// This sample requires the Places library, Maps JavaScript API.
// Include the libraries=places parameter when you first load the API.
// For example: <script
// src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
        let autocomplete;
        let address1Field;
        let address2Field;
        let postalField;

        function initAutocomplete() {
            address1Field = document.querySelector("#id_address1");
            address2Field = document.querySelector("#id_apartment_unit");
            postalField = document.querySelector("#id_postcode");
            // Create the autocomplete object, restricting the search predictions to
            // addresses in mel rectangle range.
            const sw = {lat: -38.594825, lng: 144.304146};
            const ne = {lat: -37.249765, lng: 145.842310}
            const cornerBounds = new google.maps.LatLngBounds(sw, ne);
            autocomplete = new google.maps.places.Autocomplete(address1Field, {
                {#componentRestrictions: {country: ["us", "ca"]},#}
                fields: ["address_components", "geometry"],
                types: ["address"],
            });
            autocomplete.setBounds(cornerBounds)
            address1Field.focus();
            // When the user selects an address from the drop-down, populate the
            // address fields in the form.
            autocomplete.addListener("place_changed", fillInAddress);
        }

        function fillInAddress() {
            // Get the place details from the autocomplete object.
            const place = autocomplete.getPlace();
            let address1 = "";
            let postcode = "";

            // Get each component of the address from the place details,
            // and then fill-in the corresponding field on the form.
            // place.address_components are google.maps.GeocoderAddressComponent objects
            // which are documented at http://goo.gle/3l5i5Mr
            for (const component of place.address_components) {
                // @ts-ignore remove once typings fixed
                const componentType = component.types[0];

                switch (componentType) {
                    case "street_number": {
                        address1 = `${component.long_name} ${address1}`;
                        break;
                    }

                    case "route": {
                        address1 += component.short_name;
                        break;
                    }

                    case "postal_code": {
                        postcode = `${component.long_name}${postcode}`;
                        break;
                    }

                    case "postal_code_suffix": {
                        postcode = `${postcode}-${component.long_name}`;
                        break;
                    }
                    case "locality":
                        document.querySelector("#id_city").value = component.long_name;
                        break;
                    case "administrative_area_level_1": {
                        document.querySelector("#id_state_province").value = component.short_name;
                        break;
                    }
                    case "country":
                        document.querySelector("#id_country").value = component.long_name;
                        break;
                }
            }

            address1Field.value = address1;
            postalField.value = postcode;
            // After filling the form with address components from the Autocomplete
            // prediction, set cursor focus on the second address line to encourage
            // entry of subpremise information such as apartment, unit, or floor number.
            address2Field.focus();
        }

        window.initAutocomplete = initAutocomplete;

    </script>

{% endblock %}